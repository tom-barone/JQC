<%= bootstrap_form_with model: @application, local: true,
                        html: { autocomplete: 'off', class: 'h-100 d-flex flex-column' },
                        data: {
                          controller: 'unsaved-changes uploaded-risk-rating canceallable reference-number',
                          action: 'change->unsaved-changes#onFormChange'
                        } do |form| %>

  <nav>
    <div class="nav nav-tabs" id="nav-tab" role="tablist">
      <button
        class="nav-link active"
        id="admin-invoicing-tab"
        data-bs-toggle="tab"
        data-bs-target="#admin-invoicing-tab-pane"
        type="button"
        role="tab"
        aria-controls="admin-invoicing-tab-pane"
        aria-selected="true">Administration & Invoicing</button>
      <button
        class="nav-link"
        id="certification-tab"
        data-bs-toggle="tab"
        data-bs-target="#certification-tab-pane"
        type="button"
        role="tab"
        aria-controls="certification-tab-pane"
        aria-selected="false">Certification</button>
      <button
        class="nav-link"
        id="attachments-tab"
        data-bs-toggle="tab"
        data-bs-target="#attachments-tab-pane"
        type="button"
        role="tab"
        aria-controls="attachments-tab-pane"
        aria-selected="false">Attachments (<%= @application.attachments.length %>)</button>
    </div>
  </nav>
  <div
    class="
      tab-content mb-3 bg-white border border-1 rounded-bottom-1 p-3 flex-grow-1
      d-flex flex-column
    "
    style="border-top: none !important">
    <div
      class="tab-pane show active h-100"
      id="admin-invoicing-tab-pane"
      role="tabpanel"
      aria-labelledby="admin-invoicing-tab"
      data-canceallable-target="fieldsContainer">
      <div class="h-100 d-flex flex-column flex-grow-1">
        <div class="flex-grow-1">
          <%= render 'applications/form/administration_fields',
                     application: @application,
                     form: form %>
        </div>
      </div>
    </div>

    <div
      class="tab-pane h-100"
      id="certification-tab-pane"
      role="tabpanel"
      aria-labelledby="certification-tab"
      data-canceallable-target="fieldsContainer">
      <div class="h-100 d-flex flex-column flex-grow-1">
        <div class="flex-grow-1">
          <%= render 'applications/form/certification_fields',
                     application: @application,
                     form: form %>
        </div>
      </div>
    </div>

    <div
      class="tab-pane h-100"
      id="attachments-tab-pane"
      role="tabpanel"
      aria-labelledby="attachments-tab"
      data-canceallable-target="fieldsContainer">
      <div class="h-100 d-flex flex-column flex-grow-1">
        <div class="flex-grow-1">
          <%= render 'applications/form/attachments', application: @application, form: form %>
        </div>
      </div>
    </div>

    <%= render 'applications/form/form_submission_bar', form: form %>
  </div>
<% end %>
